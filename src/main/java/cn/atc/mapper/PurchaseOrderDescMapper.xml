<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper SYSTEM "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.atc.mapper.PurchaseOrderDescMapper">
	<resultMap type="PurchaseOrderDesc"
		id="purchaseOrderDescByOrderId">
		<id column="cid" property="id" />
		<result column="orderNum" property="orderNum" />
		<result column="purchaseOrderId" property="purchaseOrderId"/>
		<association property="partType" javaType="PartType">
			<id column="eid" property="id" />
			<result column="partType" property="partType" />
			<association property="partClassify"
				javaType="PartClassify">
				<id column="yid" property="id" />
				<result column="partName" property="partName" />
			</association>
		</association>
		<association property="purchaseOrder" javaType="PurchaseOrder">
			<id column="id" property="id" />
			<result column="purchaseTime" property="purchaseTime" />
			<result column="isSignin" property="isSignin" />
			<result column="notPassDesc" property="notPassDesc" />
			<result column="auditTime" property="auditTime" />
			<association property="buyerEmp" javaType="Employee">
				<id property="id" column="buyerId" />
				<result column="buyerName" property="name" />
			</association>
			<association property="consigneeEmp" javaType="Employee">
				<id property="id" column="consigneeId" />
				<result column="consigneeName" property="name" />
			</association>
			<association property="auditorEmp" javaType="Employee">
				<id property="id" column="auditorId" />
				<result column="auditorName" property="name" />
			</association>
			<association property="auditState" javaType="AuditState">
				<id property="id" column="auditstateId" />
				<result column="auditStateName" property="auditStateName" />
			</association>
		</association>
	</resultMap>
	<select id="getPurchaseOrderDescByOrderId" parameterType="Long"
		resultMap="purchaseOrderDescByOrderId">
		SELECT p1.`id` AS 'cid',p1.`orderNum`,p1.`purchaseOrderId`,p2.`id` AS
		'eid',p2.`partType`,p3.`id` AS 'yid',p3.`partName`,p4.*,
		e1.`id` AS 'buyerId',e1.`name` AS 'buyerName',
		e2.`id` AS 'auditorId',e2.`name` AS 'auditorName',
		e3.`id` AS
		'consigneeId',e3.`name` AS 'consigneeName',
		a.`id` AS
		'auditstateId',a.`auditStateName` FROM
		purchaseorderdesc p1
		INNER JOIN parttype p2 ON p2.`id`= p1.`partTypeId`
		INNER JOIN partclassify p3 ON p3.`id` = p2.`partClassId`
		INNER JOIN purchaseOrder p4 ON p4.id=p1.purchaseOrderId
		INNER JOIN
		employee e1 ON p4.`buyer`=e1.`id`
		INNER JOIN employee e2 ON
		p4.`auditor`=e2.`id`
		INNER JOIN employee e3 ON p4.`consignee`=e3.`id`
		INNER JOIN auditstate a ON p4.`auditStateId`=a.`id`
		<where>
			p1.`purchaseOrderId` = #{orderId}
		</where>
	</select>
</mapper>
